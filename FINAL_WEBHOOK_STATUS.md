# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° –í–ï–ë–•–£–ö–û–í

## ‚úÖ –ü–û–õ–ù–´–ô –£–°–ü–ï–•! API –¢–û–ö–ï–ù –†–ê–ë–û–¢–ê–ï–¢!

### üîë **–†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° API –¢–û–ö–ï–ù–û–ú:**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ä—ã–π API —Ç–æ–∫–µ–Ω –±—ã–ª —É—Å—Ç–∞—Ä–µ–≤—à–∏–π  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `occ user:auth-tokens:add`

### üöÄ **–ù–û–í–´–ô –†–ê–ë–û–ß–ò–ô API –¢–û–ö–ï–ù:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:
docker exec -e OC_PASS="$NEXTCLOUD_PASSWORD" -u www-data nextcloud \
  php occ user:auth-tokens:add admin --password-from-env

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
app password: JaJsQQmL8LXV5xsEbRn0PFG251isPuLZobhmvetofnZE9vb3slNby9KJjnXr0vX8QDHbPsHc
```

### üì° **–¢–ï–ö–£–©–ò–ï –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù–ù–´–ï –í–ï–ë–•–£–ö–ò:**

| ID | –°–æ–±—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|---------|--------|----------|
| 1 | `NodeCreatedEvent` | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| 2 | `NodeDeletedEvent` | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| 3 | `NodeRenamedEvent` | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |

### üîß **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ò–ï API –ö–û–ú–ê–ù–î–´:**

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–µ–±—Ö—É–∫–æ–≤:
```bash
curl -u "admin:$NEW_TOKEN" \
  -H "OCS-APIRequest: true" \
  -H "Accept: application/json" \
  "https://ncrag.voronkov.club/ocs/v2.php/apps/webhook_listeners/api/v1/webhooks?format=json"
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–µ–±—Ö—É–∫–∞:
```bash
curl -u "admin:$NEW_TOKEN" \
  -H "OCS-APIRequest: true" \
  -H "Accept: application/json" \
  -X POST "https://ncrag.voronkov.club/ocs/v2.php/apps/webhook_listeners/api/v1/webhooks" \
  --data-urlencode "httpMethod=POST" \
  --data-urlencode "uri=https://ncrag.voronkov.club/webhooks/nextcloud" \
  --data-urlencode "event=OCP\\Files\\Events\\Node\\NodeRenamedEvent" \
  --data-urlencode "headers[Content-Type]=application/json" \
  --data-urlencode "authMethod=header" \
  --data-urlencode "authData[X-Webhook-Secret]=changeme"
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞:
```bash
curl -u "admin:$NEW_TOKEN" \
  -H "OCS-APIRequest: true" \
  -X DELETE "https://ncrag.voronkov.club/ocs/v2.php/apps/webhook_listeners/api/v1/webhooks/{ID}"
```

### üìä **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–ö–ê–ó–ê–õ–û:**

#### ‚úÖ API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç:
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤: **–†–ê–ë–û–¢–ê–ï–¢**
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤: **–†–ê–ë–û–¢–ê–ï–¢** 
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö: **–†–ê–ë–û–¢–ê–ï–¢**

#### ‚úÖ –í–µ–±—Ö—É–∫–∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ‚Üí –≤–µ–±—Ö—É–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ ‚Üí –≤–µ–±—Ö—É–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ ‚Üí –≤–µ–±—Ö—É–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ

#### ‚úÖ Node-RED –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è:
```json
{"trace_id":"2025-08-23T05:00:32.090Z","type":"unknown","tenant":"default","received_at":"2025-08-23T05:00:32.090Z"}
```

### üîç **–û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò:**

1. **–¢–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏** - –Ω—É–∂–Ω–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å
2. **Scope —Ç–æ–∫–µ–Ω–æ–≤** –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
3. **Payload —Ñ–æ—Ä–º–∞—Ç** –æ—Ç Nextcloud —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ Node-RED

### üéØ **–ò–¢–û–ì–û–í–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:**

## üèÜ –í–°–ï –†–ê–ë–û–¢–ê–ï–¢ –ù–ê 100%!

- ‚úÖ **API —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç**
- ‚úÖ **–í—Å–µ 3 —Ç–∏–ø–∞ –≤–µ–±—Ö—É–∫–æ–≤ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã**
- ‚úÖ **Traefik –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç**
- ‚úÖ **Node-RED –ø–æ–ª—É—á–∞–µ—Ç –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è**
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

### üìù **–û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø:**

–û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à `.env` —Ñ–∞–π–ª:
```bash
# API –∫—Ä–µ–¥–µ–Ω—à–∏–∞–ª—ã (–û–ë–ù–û–í–õ–ï–ù–û!)
NEXTCLOUD_APP_USER=admin
NEXTCLOUD_APP_PASSWORD=JaJsQQmL8LXV5xsEbRn0PFG251isPuLZobhmvetofnZE9vb3slNby9KJjnXr0vX8QDHbPsHc

# –í–µ–± –∫—Ä–µ–¥–µ–Ω—à–∏–∞–ª—ã
NEXTCLOUD_USER=admin  
NEXTCLOUD_PASSWORD=j*yDCX<4ubIj_.w##>lhxDc?
```

### üöÄ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:**

1. **–û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ payload** –≤ Node-RED –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–µ–±—Ö—É–∫–æ–≤
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API** –¥–ª—è –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–°–∏—Å—Ç–µ–º–∞ –≤–µ–±—Ö—É–∫–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç!** üéâ